\documentclass[czech,bachelor,dept460,male,csharp,cpdeclaration]{diploma}

\usepackage[autostyle=true,czech=quotes]{csquotes} % korektni sazba uvozovek, podpora pro balik biblatex
\usepackage[backend=bibtex, style=iso-numeric, alldates=iso]{biblatex} % bibliografie
\usepackage{dcolumn} % sloupce tabulky s ciselnymi hodnotami
\usepackage{subfig} % makra pro "podobrazky" a "podtabulky"
\usepackage{rotating}

\usepackage{geometry}
\usepackage{listings}

%\usepackage{mathtools} %- blokuje list obrázků a tabulek

\ThesisAuthor{Bc. Jan Jedlička}

\ThesisSupervisor{prof. Ing. Michal Krátký, Ph.D.}

\CzechThesisTitle{Key-value databázové systémy}

\EnglishThesisTitle{Key-value database systems}

\SubmissionYear{2023}

\Acknowledgement{Rád bych na tomto místě poděkoval vedoucímu diplomové práce panu prof. Ing. Michalovi Krátkému, za pravidelné konzultace a poskytnutí mnoha užitečných rad a nápadů pro řešení samotné práce.}

\CzechAbstract{Cílem diplomové práce je popsat Key-value databázové systémy, ukázat výhodo těchto systémů a představit jedny z jejich významných představitelů. Součástí práce je návrh a implementace testovacího prostředí pro testování těchto systémů s ostatnímy SŘBD. Práce je zakončena vyhodnocením výsledků testů vybraných databázových systémů.}

\CzechKeywords{NoSQL; Key-value databáze}

\EnglishAbstract{The aim of the diploma thesis is to describe Key-value database systems, to show the advantage of these systems and to present some of their important representatives. Part of the work is the design and implementation of a test environment for testing these systems with other DBMS. The work is finished with an evaluation of the test results of selected database systems.}

\EnglishKeywords{NoSQL; Key-value database}

\AddAcronym{NoSQL}{No Structured Query Language}
\AddAcronym{Key-value database}{Klíč-hodnota databáze}
\AddAcronym{TTL}{Time to live}

\addbibresource{citace.bib}

\begin{document}
	
	\MakeTitlePages
	
	\chapter{Úvod}
	
	NoSQL Key-value (neboli Klíč-hodnota) databáze\cite{wiki-key-value-db} je jedno z paradigmat pro uložiště dat. Databáze je navržena pro ukládání, načítání a správu různých datových struktur, dnes známých jako slovníky nebo hashovací tabulky. Slovníky obsahují kolekci objektů či záznamů, které mohou opět obsahovat množinu různých polí s daty. Záznamy jsou do slovníků, či hashovacích tabulek, ukládána za pomoci klíče, který identifikuje pozici záznamu v datové struktuře a používá se k následnému vyhledávání dat v databázi.
	
	Key-value databáze fungují velice odlišně než tradiční relační databázové systémy. Relační databáze mají předdefinovanou datovou strukturu v databázi jako sérii tabulek s dopředu definovanými datovými typy. Díky tomuto modelu může relační databázový systém provádět řadu optimalizací. Na druhou stranu Key-value databázové systémy mohou mít pro každý záznam různě definované kolekce dat s odlišnými velikostmi a počty atributů. Tato vlastnost nabízí Key-value databázovým systémům flexibilitu a možnost přiblížení se k objektově orientovanému programování. Protože Key-value databáze nevyžaduje pevně nastavené datkové typy hodnot, jako je tomu u relační databáze, tak Key-value databáze často potřebují méně paměti k uložení stajných dat, což může vést k značnému nárůstu výkonu.
	
	Výkon a nedostatečná standardizace omezovaly Key-value databázové systémy pouze na specializovaná využití, ale díky rychlému přechodu na cloud computing dochází v posledních letech k rozšíření obecné využitelnosti NoSQL databázových systémů. Například databázový systém Redis\cite{redis} je v současnosti jedním z deseti nejlépe hodnocenách\cite{db-engineers-ranking} databázových systémů napříč relačními i NoSQL databázovými systémy.
	
	\chapter{NoSQL Key-value databázové systémy}
	
	V současné době existuje nespočet různých Key-value databázových systémů, od malých open source projektů po velké placené cloud služby. Různé systém disponují odlišnými vlastnostmy jako je propustnost, škálovatelnost, uživatlká přívětivost skrz dotazovací jazyk a podporu aj. Dle průzkumu\cite{predictiveanalyticstoday}\cite{g2}\cite{db-engineers-ranking}  bylo vybráno 10 aktuálně významých Key-value databázových systémů se snahou o jednoduchý popis, porovnání a konešný výběr vhodnách Key-value databázových systémů se snahou otestovat vlastnosti těchto systémů.
	
	\section{Amazon DynamoDB}
	
	Amazon DynamoDB\cite{dynamodb} je v současné době největší a nejvyužívanější Key-value databázový systém. Jedná se o serverless cloud systém s odezvou v řádu jednotek mikrosekund a využitím v oblastech jako je web tech, IoT, mobile a gaming. DynamoDB je plně a automaticky spravovatelná, multi master databáze zaměřené na vysoké využití horizontální škálovatelnosti. Unikátní primární klíče umožňují identifikaci jednotlivých záznamů v tabulkách a sekundární index zlepšuje dodazovací flexibilitu. Primární klíč je jako vstup do hashovací funkce a výsledý hash nám udává fyzickou pozici uloženého záznamu. DynamoDB poskytuje silnou konzistenci na čtení hodnot od posledních aktualizací. Atomické čitače umožňuí automatické změny hodnot číselných atribnutů. Využívá TTL pro prošlé záznamy v tabulkách. Archivace dat je umožněna díky full backupu. Systém má konzolové API pro správu databáze a práci s daty, systém však nabízí i možnost využití SQL jazyka. Amazon DynamoDB má i VPC pro soukromou komunikaci bez potřeby využití indernetu.
		
	\section{Oracle NoSQL Database}
	
	Oracle NoSQL Database\cite{oraclenosqldb} je databázová cloud služba vhodná pro práci s velkými objemy dat a odhadovatelnou nízkou odezvou v řádu jednotek milisekund. Služba je postavena na enginu z Oracle Berkley DB. Databáze je plně spravovatelná, flexibilní, škáluje dynamicky a dosahuje vysokých výkonů. Mimo Key-value data se jedná i o spolehlivé uložiště pro dokumenty a data s pevně daným schématem. Vzhledem k tomu že databázový systém je plně spravovaný společností Oracle, tak je pro vývojáře rychlé a snadné začít tuto službu využívat a soustředit se pouze na vývoj aplikací, neboť není potřeba se obtěžovat se správou základní infrastruktury databáze, softwaru, zabezpečení atp. Jedná se o Single Master, Multi Replica grafový systém. Pokud dojde k chybě na masteru, je master automaticky nahrazen jednou z replik. Pro Key-value ukládání s kapacitu jednotek Terabytů využívá systém velký počet Storage uzlů, které je možno skupinově konfigurovat. Pro udržení konzistence jsou Storage uzly replikovány. Uzly a hrany v grafu reprezentují entity které vytvářejí vztahy a propojení. Sdílený systém, uniformně alokuje data okolo ostatních částí skupin. Databáze obsahuje i SQL Query s jazykem pro import, export a přenos dat mezi různými Oracle NoSQL databázemi. Mimo jiné je zde podpora i pro Failover, SwitchOver, Bulk Get API, Off Heap Cache a podpora Big Data SQL.
		
	\section{Redis}
	
	Redis\cite{redis} je in-memory uložiště pro datové struktury, využívané jako Key-value databáze, cache, streaming engine nebo zprostředkovávatel zpráv. Toto datové uložiště má skvělé využití pro klíče v podobě hashe a hodnoty jako velký json objekt. Pro perzistenci dat můžeme ukládání dat na disk provádět po nasatvitelných pravidelných intervalech, nebo je možné data logovat vždy při vykonávání operací, pokud nemáme zájem o trvanlivost dat je možné ukládání dat vypnout úplně a datové uložioště využít čistě jako cache. Redis podpuruje datové struktury jako stringy, hashe, listy, množiny, bitmapy, hyperloglog a geospatial indexy. Nad datovými typy Redis umožňuje rychlé atomické operace jako rozšíření stringů, přídání prvků na začátek a konec listů atd. Datové uložiště také poskytuje setřízené množiny pro vytváření indexů dle ID nebo jiného číselného atributu. Redis hashing ukládá data jako klíč a mapu. Keyspace notifikace dovoluje klientům odebírat Publisher-Subscriber kanály. Pro práci s dotazy na souřadnice a geometrii je možné využívat Geo API. Redis umožňuje provádět transakce, volat lua skripty a nastavovat různé úrovně TTL pro záznamy. Redis podporuje Trivial-to-setup Master-Slave asynchronního replikování, společně s rychlou neblokující se prvotní synchronizaci. Struktura pro ukládání dat je Single-rooted replikovaný strom. Redis má vlastní API pro práci s daty pro populární programovací jazyky jako C, Python, Java a Javascript.
			
	\section{Aerospike}
	
	Aerospike\cite{aerospike} je Key-value databáze využívající Hybrid Memory architekturu\cite{hybmem-arch}, která umožňuje odezvu do jednotek milisekund a vysokou propustnost v řádu stovek tisíc až milionu operací za sekundu. Hybrid Memory architektura od Aeorispike je implementována tak, že index je čistě In-Memory, tím pádem není index persistentní (vhodné například pro uživatelské cache sessions), a data jsou uložena čistě persistentně na SSD disku a čtou se přímo z něj. Díky tomu že je Aerospike jako Key-value databáze naprosto Schena-less tak je možné definovat Sets a Bins za běhu pro maximální flexibilitu aplikací. Databáze škáluje lineárně a poskytuje silnou konzistenci, nízkou cenu a korektnost. Umožňuje real-time analýzu pro rychlé rozhodování a dynamickou optimalizaci pro vhodné využívání zdrojů dat, proto je databáze vhodná pro velké a stále aktualizované databáze. Poskytuje server-side clustering, bezpečnost na transportní vrstvě. Databáze také umožňuje Customer deployment s nulovým downtime. V praxy se Aerospike díky svým vlastnostem využívá například pro banking, telekominkace, adtech a gaming. Aerospike poskytuje vlastní silný dotazovací jazyk AQL\cite{aql}, který má prakticky shodnou syntaxi jako SQL (i když se o SQL nejedná). vlastní vytvořitelné agregační funkce pomocí Lua jazyku (flexibilní pro agregační algoritmy).
	
	\section{Oracle Berkeley DB}
	
		\begin{itemize}
			\item knihovna pro službu key-value db
			\item čistě in-memory db
			\item ultra-low odezva, škálovatelná, vysoce výkonná
			\item velice dostupná, tolerance chybovosti
			\item B-stromy, fronty, hash data indexy
			\item obnovitelné ACID transakce, více úrovní izolace (včetně MVCC)
			\item rozdělení dat dle key ranges
			\item možnost komprese záznamů
			\item jednoduché volání API pro přístup k datům a nastavení db
			\item stavební části pro  db od lokálního uložiště po world-wide distribuovanou db (od KiloBytů po PetaByty)
			\item data uložená v XML, SQL (když není potřeba tak se využívá právě KeyValue uložiště), Java Objekty
			\item podpora moderních programovacích jazyků (C++, C\#, Java, Python atp.)
			\item Single master, multi replica, vysoce dostupná konfigurovatelnost db
			\item repliky umožňují čtecí škálovatelnost, rychlý fail-over, hot-standby a další distribuované konfigurace dodávající podnikové prostředky v málém, vestavěném balíčku
		\end{itemize}
 
	
	\section{Riak KV}
		\begin{itemize}
			\item distibuovaná kv db, pokročilé lokální a multi-cluster replikování
			\item garance čtení a zápisu i při selhání HW nebo síťových oddílů
			\item bez konfliktní replikované datové typy (CRDTs), flags, registry, čitače, množiny a mapy
			\item konfigurace aktivního clusteru, poskytování dat pro klienty díky nízké latenci z nejbližšího data centra
			\item dostupné zóny, multi claster repliky a redundance dat v geografickém regionu
			\item flexibilní datový model bez pre definovaného schématu
			\item vylepšené logování chyb a reporty
			\item automatická komprese dat pomocí Snappy kompresní knihovny
			\item vhodná pro ukládání velkého množství nestrukturovaných dat
			\item pro big-data aplikace, ukládání dat z připojených zařáízení a replikování dat do okolí
			\item automatický distribuce dat skrz cluster, pro robustnost, výkon
			\item master-less architektura, vysoká dostupnost, téměř lineární škálovatelnost za využití snadného přidání HW kapacity bez nutnosti mnoha operací
			\item nízká latence, vhodná pro chat/messaging aplikace
			\item možnost zpracování dat pro získání užitečných závěrů a akceschopných informací
			\item design pro horizontálůní škálovatelnost s komoditním HW, jednoduché pro rozšíření objemu dat bez potřeby vytváření komplexního sdílení
			\item bez vnocování restrikcí na hodnoty, session data mohou být enkódována mnoha způsoby a nevyžadují změnu schématu
			\item během nejvyšší zátěže nezhoršuje zápis a horizontální škálovatelnost, uživatelé jsou obslouženi bez problémů
			\item dobrý pro soukromé, veřejné i hybridní cloud nasazování
		\end{itemize}
 
	
	\section{Voldemort}
			\begin{itemize}
				\item distribuovaná kv db založena na Amazon DynamoDB
				\item automatická replikace dat skrz více serverů
				\item automatické rozdělování dat mezi servery, každý server obsahuje pouze část z celkových dat
				\item nastavitelná konzistenčnoust
				\item transparentní ošetřování chyb serverů
				\item zapojitelný storage-engine (MySQL, Read-Only) a serializace (Java Serialization, Thrift, Avro) 
				\item verzování dat pro maximální integritu i během poruch
				\item každý uzel je samostatný a nezávislý, žádný centrální řídící uzel nebo uzel řídící řešení chyb
				\item dobrá výkonost na jeden uzel, 10-20 tisíc operací za sekundu (1 op. za 50 mikro sekund) dle HW, sítě, systému disku atp.
				\item podpora zapojitelné strategie pro rozpoložení dat, pro možnost distribuce dat skrz data centra která jsou mezi sebou geologicky velice vzdálená
				\item využívá JMX pro zlepšení viditelnosti pro interní monitorování a validaci dat
				\item In-Memory caching pro eliminaci oddělených částí cache, jednoduché a rychlé in-memory tenstování (unit testy)
				\item horizontální škálování čtení i zápisu
				\item API rozhoduje o replikování a místě ukládání dat, různé strategie pro specifické aplikace
				\item široké možnosti pro klíče i hodnoty díky serializaci, listy a tuply s pojmenovanými poli
				\item JSON data model pro serializaci ale v kompaktním bytovém formátu, typová kontrola dat dle očekávaného schématu
				\item hashovatelné schéma, vyhledávání dle primárního klíče a možnost modifikace jednotlivých hodnot
				\item jednoduchá distribuce skrz stroje protože data mohou být rozdělována dle primárních klíčů
				\item dostupnost a bezpečnost jednotlivých oddílů při vysoké propustnosi
			\end{itemize}
	
	\section{InfinityDB}
		
		\begin{itemize}
			\item Nestable Multi-value, může reprezentovat stromy, grafy, Key/Value mapy, dokumenty, velká řidká pole, tabulky
			\item ACID pro vlákna, ACD pro bulk operace
			\item jednoduché API, instantní produktuvita developerů
			\item dynamický pohled dotazů (set logic views, delta views, ranges)
			\item samostatná administrace, jeden soubor (bez konfiguračních souborů, logů, dočasných souiborů, upgrade skriptů a DBA)
			\item není potřeba dělat čištění junk souborů po operacích když zde nejsou žádné zanechýny
			\item runtime schema evolution (pro dopřednou a zpětnou kompatibilitu)
			\item all-Java db pro servery, procovní stanice, ruční zařízení
			\item protokol robustní vnitřní uložiště pro vytrvání na požádání nebo rozdělení cache na disk pro velké množstí dat
			\item single data file, aktuální, bezpečný, korektní a využitelný pro každý případ (je designovaný pro použití jednoho souboru)
			\item bez zotavení na základě logu, restart a zotavení je vždy okamžité
			\item kombinace jednoho souboru a instantního zotavení nevyžaduje administraci db
			\item prostor pro uložení strukturovaných, polostrukturovaných a nestrukturovaných dat, tento jednoduchý model umožňuje ukládání stromů, grafů apod.
			\item možnost využít In-Memory-Only db která nechá všechna data v cachy, nebo naopak se data ukládají normálně do souboru, je možnost si vybrat bez změny kódu
			\item přístup k datům v cachy je plně více vláknový
			\item data která nejsou často využívaná jsou stránkována na disk
		\end{itemize}

	\section {Porovnání KV DB}
			\begin{tabular}{ |l||p{2cm} p{2cm} l p{4cm} | } 
				\hline
				Název & Správa & Škálovatelnost & Odezva & Zotavení \\
				\hline
				Amazon DynamoDB & automatická, plně spravovatelná & vysoká, horizontální & mikrosekundy & logy, záloha, automatické obnovení \\
				\hline
				Oracle NoSQL DB & nízká & horizontální & milisekundy & replika je prohlášena za master\\ 
				\hline
				InfinityDB & jeden soubor se vším & nízká & milisekundy & bez logů, okamžité ale ztrácíme data\\ 
				\hline
				Redis & plná & horizontální & milisekundy & z logů (logování snižuje výkon)\\
				\hline
				Aerospike & plně spravovatelná & lineární & milisekundy &  logy, záloha\\
				\hline
				Oracle Berkeley DB & velká & horizontální & mikrosekundy & repliy \\
				\hline
				Riak KV & vysoká & horizontální, téměř lineární & milisekundy & multi cluster repliky, logování\\
				\hline
				Voldemort & vysoká & horizontální & milisekundy &  repliky \\
				\hline
			\end{tabular}


	\section {Nezmíněné významné KV DB v 2022}
		\begin{itemize}
			\item MongoDB
			\item Couchbase
			\item Azure Cosmos DB
		\end{itemize}

	\chapter{Prostředí pro testování databázových systémů}
	
	TODO
	
	\chapter{Vyhodnocení výsledků testů}
	
	TODO
	
	\chapter{Závěr}
	
	TODO
		
	\nocite{*}
	
	\printbibliography[title={Literatura}, heading=bibintoc]
	
\end{document}